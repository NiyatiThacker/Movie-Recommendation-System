<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Recommendation System</title>
    
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
   
        
   <!---- <style>
       /* /* Google Font */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');
    
        /* Cyberpunk Grid Background */
        body {
            background-color: #2b013a;
            background-image: 
                linear-gradient(90deg, rgba(255, 255, 255, 0.1) 1px, transparent 1px), 
                linear-gradient(0deg, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            color: white;
            font-family: 'Poppins', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        
    
        /* Neon UI Window */
        .container {
    width: 60%;
    max-width: 700px;
    background: rgba(210, 0, 255, 0.2);
    border: 3px solid #d200ff;
    box-shadow: 0 0 15px #d200ff;
    border-radius: 15px;
    padding: 30px;
    text-align: center;
    min-height: 500px; /* Ensures enough space to prevent shifts */
}

    
        /* Title Styling */
        h1 {
            font-size: 24px;
            font-weight: 600;
            color: #ff00ff;
            margin-bottom: 20px;
            text-shadow: 0px 0px 10px #ff00ff;
        }
    
        /* Input Fields */
        .input-container {
            width: 100%;
            margin-bottom: 15px;
            min-height: 60px; 
        }
    
       
        input, select {
    height: 45px; /* Fixed height to avoid expansion */
    width: 100%;
    padding: 12px;
    font-size: 16px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: white;
    border-radius: 8px;
    outline: none;
    transition: all 0.3s ease;
}

    
        input:focus, select:focus {
            border-color: #ff00ff;
            box-shadow: 0px 0px 10px #ff00ff;
        }
    
        /* Button */
        .btn-custom {
            width: 100%;
            background: linear-gradient(90deg, #6a0dad, #9c27b0);
            color: white;
            font-size: 16px;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 10px;
            transition: 0.3s ease-in-out;
        }
    
        .btn-custom:hover {
            transform: scale(1.05);
            box-shadow: 0px 0px 15px rgba(156, 39, 176, 0.8);
        }
    
        /* Movie Recommendation Box */
        
        .recommendations {
    min-height: 120px; /* Preallocates space */
    max-height: 200px; /* Limits max growth */
    overflow-y: auto; /* Scroll if too many results */
    margin-top: 20px;
    padding: 15px;
    border-radius: 10px;
    background: rgba(255, 255, 255, 0.1);
    box-shadow: inset 0px 0px 15px rgba(255, 255, 255, 0.2);
}



    
        .movie-item {
            font-size: 18px;
            padding: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
    
        .movie-item:last-child {
            border-bottom: none;
        }
        

h1 {
    white-space: nowrap; /* Prevents breaking */
    text-align: center;
    font-size: 2rem;
    padding: 10px;
    margin: 0 auto;
    display: block;
    width: 100%; /* Ensures it spans the full width */
}


.card {
    overflow: hidden;
}

.title-container {
    position: absolute;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    text-align: center;
    width: 100%;
}

    </style> -->
    
    <style>/* Google Font */
      /* Google Font */
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    background-color: #2b013a;
    background-image: 
        linear-gradient(90deg, rgba(255, 255, 255, 0.1) 1px, transparent 1px), 
        linear-gradient(0deg, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
    background-size: 50px 50px;
    color: white;
    font-family: 'Poppins', sans-serif;
}

/* Black background that extends dynamically */
.black-bg {
    width: 100%;
    min-height: 100vh; /* Ensures it covers full viewport height */
    background-color: black;
    padding: 20px 0;
    display: flex;
    flex-direction: column;
    align-items: center;
}

/* Content container inside black background */
.container {
    width: 80%;
    max-width: 900px;
    background: rgba(210, 0, 255, 0.2);
    border: 3px solid #d200ff;
    box-shadow: 0 0 15px #d200ff;
    border-radius: 15px;
    padding: 30px;
    text-align: center;
    min-height: 500px; /* Ensures minimum height */
}

/* Title */
.title-container {
    text-align: center;
    font-size: 2rem;
    padding: 10px;
    text-shadow: 0px 0px 10px #ff00ff;
}

/* Input Fields */
input, select {
    height: 45px;
    width: 100%;
    padding: 12px;
    font-size: 16px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: white;
    border-radius: 8px;
    outline: none;
}

/* Button */
.btn-custom {
    width: 100%;
    background: linear-gradient(90deg, #6a0dad, #9c27b0);
    color: white;
    font-size: 16px;
    padding: 12px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    margin-top: 10px;
    transition: 0.3s ease-in-out;
}

.btn-custom:hover {
    transform: scale(1.05);
    box-shadow: 0px 0px 15px rgba(156, 39, 176, 0.8);
}

/* Ensure black background extends when content grows */
html, body {
    height: 100%;
}

.black-bg {
    min-height: 100%;
    height: auto;
}

        </style>
</head>
<body>
    
    <div class="container text-center">
        <h1 class="mb-4">üé¨ Movie Recommendation System</h1>

        <!-- User-Based Recommendations -->
        <div class="card p-4 mb-4">
            <h4>üîç Get Personalized Recommendations</h4>
            <input type="number" id="user_id" class="form-control my-2" placeholder="Enter User ID">
            <button class="btn btn-custom w-100" onclick="getUserRecommendations()">Recommend</button>
            <ul id="user_history" class="list-group mt-2"></ul>
            <div id="user_results" class="mt-3"></div>
        </div>

        <!-- Movie Similarity Recommendations -->
        <div class="card p-4">
            <h4>üé• Find Similar Movies</h4>
            <input type="text" id="movie_title" class="form-control my-2" placeholder="Enter Movie Title" onkeyup="showSuggestions(this.value)">
            <ul id="suggestions" class="list-group"></ul>
            <button class="btn btn-custom w-100" onclick="getMovieRecommendations()">Find Similar</button>

            <h5>üîç Recent Searches</h5>
<ul id="movie_history" class="list-group"></ul>
<button id="clearSearch" class="btn-clear w-100 mt-2">üóë Clear Recent Searches</button>



            <h5>üéØ Your Watchlist</h5>
            <ul id="watchlist" class="list-group"></ul>


            <!-- ‚úÖ Fixed: Missing Results Display -->
            <div id="movie_results" class="mt-3"></div>
        </div>
    </div>
    
    
        
    

<script>
    async function getUserRecommendations() {
    const userId = document.getElementById("user_id").value.trim();
    const resultDiv = document.getElementById("user_results");
    const historyList = document.getElementById("user_history");

    if (!userId) {
        alert("Please enter a valid User ID!");
        return;
    }

    resultDiv.innerHTML = `<p class="text-info">üîÑ Fetching recommendations...</p>`;

    try {
        const response = await fetch("/recommend_user", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ "user_id": userId })
        });

        const data = await response.json();

        if (data.error) {
            resultDiv.innerHTML = `<p class="text-danger">‚ùå ${data.error}</p>`;
            return;
        }

        // Display recommended movies
        resultDiv.innerHTML = `<h5>üìå Recommended Movies:</h5><ul class="list-group">` + 
            data.map(movie => `<li class="list-group-item">${movie.title} (ID: ${movie.id})</li>`).join("") + `</ul>`;

        // Add to user history
        const historyItem = document.createElement("li");
        historyItem.className = "list-group-item";
        historyItem.textContent = `User ID: ${userId} - ${data.map(m => m.title).join(", ")}`;
        historyList.prepend(historyItem);

    } catch (error) {
        resultDiv.innerHTML = `<p class="text-danger">‚ùå Failed to fetch recommendations.</p>`;
    }
}

    // ‚úÖ Get Similar Movies Based on Movie Title
    
    async function getMovieRecommendations() {
        const movieTitle = document.getElementById("movie_title").value.trim();
        const resultDiv = document.getElementById("movie_results");
        const suggestionsDiv = document.getElementById("suggestions");

        if (!movieTitle) {
            alert("Please enter a Movie Title!");
            return;
        }

        // Hide auto-suggestions when searching
        suggestionsDiv.innerHTML = "";

        // Show loading message
        resultDiv.innerHTML = `<p class="text-info">üîÑ Finding similar movies...</p>`;
        console.log("Sending request for:", movieTitle);

        try {
            const response = await fetch("/recommend_movie", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ "movie_title": movieTitle })
            });

            console.log("Response received:", response);

            if (!response.ok) {
                throw new Error(`Server error: ${response.status}`);
            }

            const data = await response.json();
            console.log("Data received:", data);

            // Handle empty or error responses
            if (data.error) {
                resultDiv.innerHTML = `<p class="text-danger">‚ùå ${data.error}</p>`;
                return;
            }

            if (data.length === 0) {
                resultDiv.innerHTML = `<p class="text-warning">‚ö† No similar movies found.</p>`;
                return;
            }

            // ‚úÖ Display similar movies with streaming platforms
            resultDiv.innerHTML = "<h5>üìå Similar Movies:</h5><ul class='list-group'>" +
                data.map(movie => `
                    <li class='list-group-item bg-dark text-light'>
                        ${movie.title} 
                        ${movie.platforms && movie.platforms.length > 0 
                            ? `<a href="${movie.platforms[0]}" target="_blank" class="badge bg-primary">üé• Watch Now</a>` 
                            : `<span class="badge bg-secondary">‚ùå Not Available</span>`}
                        <button class='btn btn-success btn-sm float-end' onclick="addToWatchlist('${movie.title}')">‚ûï Watchlist</button>
                    </li>
                `).join("") + `</ul>`;

            saveSearch(movieTitle); // ‚úÖ Save search history

        } catch (error) {
            console.error("Error fetching recommendations:", error);
            resultDiv.innerHTML = `<p class="text-danger">‚ùå Failed to get recommendations. Please try again.</p>`;
        }
    }



            

    // ‚úÖ Auto-Suggestions for Movie Titles
    async function showSuggestions(query) {
        if (query.length < 2) {
            document.getElementById("suggestions").innerHTML = "";
            return;
        }

        try {
            const response = await fetch(`/search_suggestions?query=${query}`);
            const data = await response.json();

            let suggestionsList = data.map(movie => 
                `<li class='list-group-item bg-dark text-light' onclick="selectMovie('${movie}')">${movie}</li>`
            ).join("");

            document.getElementById("suggestions").innerHTML = suggestionsList;

        } catch (error) {
            console.error("Error fetching suggestions:", error);
        }
    }

    function selectMovie(title) {
        document.getElementById("movie_title").value = title;
        document.getElementById("suggestions").innerHTML = "";
    }

    // ‚úÖ Watchlist Feature
    function addToWatchlist(movie) {
        let watchlist = JSON.parse(localStorage.getItem("watchlist")) || [];
        if (!watchlist.includes(movie)) {
            watchlist.push(movie);
            localStorage.setItem("watchlist", JSON.stringify(watchlist));
        }
        displayWatchlist();
    }

    function displayWatchlist() {
        let watchlist = JSON.parse(localStorage.getItem("watchlist")) || [];
        document.getElementById("watchlist").innerHTML = watchlist.map(movie => 
            `<li class='list-group-item bg-dark text-light'>${movie} <button class='btn btn-danger btn-sm float-end' onclick="removeFromWatchlist('${movie}')">‚ùå</button></li>`
        ).join("");
    }

    function removeFromWatchlist(movie) {
        let watchlist = JSON.parse(localStorage.getItem("watchlist")) || [];
        watchlist = watchlist.filter(m => m !== movie);
        localStorage.setItem("watchlist", JSON.stringify(watchlist));
        displayWatchlist();
    }

    // ‚úÖ Show watchlist on page load
    displayWatchlist();
   
    function saveSearch(value) {
        let history = JSON.parse(localStorage.getItem("movieSearchHistory")) || [];
        if (!history.includes(value)) {
            history.unshift(value);
            if (history.length > 5) history.pop();  // ‚úÖ Keep only last 5 searches
            localStorage.setItem("movieSearchHistory", JSON.stringify(history));
        }
        displaySearchHistory();
    }

    function displaySearchHistory() {
        let history = JSON.parse(localStorage.getItem("movieSearchHistory")) || [];
        document.getElementById("movie_history").innerHTML = history.map(movie => 
            `<li class='list-group-item bg-secondary text-white' onclick="selectMovie('${movie}')">${movie}</li>`
        ).join("");
    }
document.addEventListener("DOMContentLoaded", function () {
    const searchHistory = JSON.parse(localStorage.getItem("recentSearches")) || [];
    const recentSearchesContainer = document.getElementById("recentSearches");
    const clearButton = document.getElementById("clearSearch");

    // Function to update UI with recent searches
    function updateSearchHistory() {
        recentSearchesContainer.innerHTML = "";
        searchHistory.forEach((item, index) => {
            const li = document.createElement("li");
            li.textContent = item;
            recentSearchesContainer.appendChild(li);
        });
    }

    document.getElementById("clearSearch").addEventListener("click", function () {
    localStorage.removeItem("movieSearchHistory"); // ‚úÖ Clear from local storage
    document.getElementById("movie_history").innerHTML = ""; // ‚úÖ Clear from UI
});


    // Call function to display stored searches
    updateSearchHistory();
});

    function selectMovie(title) {
        document.getElementById("movie_title").value = title;
        document.getElementById("suggestions").innerHTML = "";
    }

    // ‚úÖ Show search history on page load
    displaySearchHistory();


</script>

</body>
</html>
